<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Neon Block Puzzle</title>
<style>
  :root {
    --bg1: #6a00ff;
    --bg2: #00b3ff;
    --bg3: #ff4fd8;
    --glass: rgba(255, 255, 255, 0.12);
    --glass-border: rgba(255, 255, 255, 0.2);
    --text: #f7f8ff;
    --accent: #00f7ff;
    --danger: #ff4f74;
    --bg-main: #354a86;
    --bg-deep: #2a3f78;
    --panel: #1f2e59;
    --panel-light: #273768;
    --text: #f6f7ff;
    --gold: #ffcf4b;
    --soft-shadow: rgba(6, 12, 30, 0.45);
    --board-border: #142349;
    --board-cell: #202d57;
    --board-cell-dark: #192548;
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html, body {
    margin: 0; padding: 0; width: 100%; height: 100%;
    font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
    background: radial-gradient(circle at top left, var(--bg3), transparent 40%),
                radial-gradient(circle at bottom right, var(--bg2), transparent 40%),
                linear-gradient(135deg, #2b0f5b, #0b1b4f 70%);
    background: radial-gradient(circle at top center, #4b62a8, var(--bg-main) 45%),
                linear-gradient(180deg, var(--bg-main), var(--bg-deep));
    color: var(--text);
    overflow: hidden;
    touch-action: none;
  }
  #app {
    width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center;
  }
  .screen {
    position: absolute; inset: 0;
    display: flex; align-items: center; justify-content: center;
    transition: opacity 0.4s ease, transform 0.4s ease;
    pointer-events: none;
    opacity: 0;
    transform: scale(1.03);
  }
  .screen.active {
    opacity: 1; transform: scale(1);
    pointer-events: auto;
  }
  .panel {
    width: min(92vw, 640px);
    background: var(--glass);
    border: 1px solid var(--glass-border);
    background: rgba(32, 45, 87, 0.92);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 24px;
    padding: 28px;
    backdrop-filter: blur(18px);
    box-shadow: 0 20px 60px rgba(5, 0, 30, 0.45), inset 0 0 40px rgba(255,255,255,0.08);
    box-shadow: 0 20px 60px rgba(5, 0, 30, 0.45), inset 0 0 30px rgba(255,255,255,0.05);
  }
  h1 {
    margin: 0 0 10px;
    font-size: 32px; letter-spacing: 1px;
    text-align: center;
    text-shadow: 0 0 14px rgba(0, 247, 255, 0.6);
  }
  .subtitle { text-align: center; opacity: 0.8; margin-bottom: 22px; }
  .menu-buttons { display: grid; gap: 14px; }
  .row { display: flex; gap: 12px; flex-wrap: wrap; }
  .btn {
    flex: 1;
    padding: 14px 16px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.2);
    background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
    background: linear-gradient(135deg, #4257a2, #2c3c74);
    color: var(--text);
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 22px rgba(0,0,0,0.3); }
  .btn:active { transform: translateY(1px) scale(0.99); }
  .btn.primary { background: linear-gradient(135deg, #5b2bff, #00d4ff); }
  .btn.alt { background: linear-gradient(135deg, #ff2b8a, #ff945b); }
  .btn.primary { background: linear-gradient(135deg, #ffb340, #f7e06f); color: #25355e; }
  .btn.alt { background: linear-gradient(135deg, #6b8bff, #4a6bdc); }
  .btn.ghost { background: transparent; border: 1px solid rgba(255,255,255,0.3); }

  #game-ui {
    width: min(96vw, 980px);
    height: min(96vh, 900px);
    width: min(92vw, 520px);
    height: min(94vh, 960px);
    display: grid;
    grid-template-rows: auto 1fr auto;
    gap: 12px;
    grid-template-rows: auto auto 1fr auto;
    gap: 10px;
    align-content: center;
  }
  .hud {
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 8px 0;
  }
  .score-chip {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    font-size: 22px;
    font-weight: 700;
    color: var(--gold);
    text-shadow: 0 3px 0 rgba(0,0,0,0.2);
  }
  .score-chip .icon {
    font-size: 28px;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
  }
  .gear-btn {
    width: 44px; height: 44px;
    border-radius: 12px;
    background: var(--panel);
    border: 1px solid rgba(255,255,255,0.08);
    display: grid; place-items: center;
    box-shadow: inset 0 0 12px rgba(255,255,255,0.05);
    cursor: pointer;
  }
  .gear-btn svg { width: 26px; height: 26px; fill: #cfe3ff; }
  .heart-score {
    display: grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap: 12px;
    place-items: center;
    padding: 6px 0 2px;
  }
  .heart {
    width: 170px; height: 130px;
    background: radial-gradient(circle at 30% 30%, #ff7de1, #ff5fd8 60%, #d043b8 100%);
    clip-path: path(\"M85 118c-20-18-42-34-58-52C10 48 12 24 31 13c17-10 39-2 48 15 9-17 31-25 48-15 19 11 21 35 4 53-16 18-38 34-58 52z\");
    filter: drop-shadow(0 12px 18px rgba(255, 70, 204, 0.4));
    display: grid; place-items: center;
  }
  .heart-score .value {
    font-size: 48px;
    font-weight: 800;
    color: white;
    text-shadow: 0 4px 0 rgba(0,0,0,0.25);
  }
  .sub-hud {
    display: flex;
    justify-content: center;
    gap: 16px;
    font-size: 13px;
    opacity: 0.85;
  }
  .hud .tile {
    background: var(--glass);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 10px 14px;
    text-align: center;
    box-shadow: inset 0 0 20px rgba(255,255,255,0.08);
  .sub-hud span {
    background: rgba(0,0,0,0.2);
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.12);
  }
  .hud .label { font-size: 12px; opacity: 0.7; }
  .hud .value { font-size: 20px; font-weight: 700; }
  #canvas-wrap {
    position: relative;
    background: rgba(10, 5, 30, 0.6);
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,0.15);
    background: var(--panel);
    border-radius: 16px;
    border: 4px solid var(--board-border);
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    box-shadow: 0 12px 30px var(--soft-shadow);
  }
  canvas { display: block; width: 100%; height: 100%; }
  #tray {
    display: grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap: 12px;
    gap: 24px;
    padding: 10px 6px 0;
  }
  .tray-item {
    background: var(--glass);
    border: 1px solid rgba(255,255,255,0.18);
    background: transparent;
    border-radius: 18px;
    min-height: 110px;
    min-height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }
  .footer-controls {
    display: flex; justify-content: space-between; gap: 12px; align-items: center;
    padding: 6px 6px 0;
  }
  .pill {
    padding: 8px 12px; border-radius: 999px; font-size: 12px;
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.2);
  }
  .overlay {
    position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
    background: rgba(5, 0, 20, 0.5);
    backdrop-filter: blur(6px);
    opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
  }
  .overlay.active { opacity: 1; pointer-events: auto; }
  .popup {
    position: absolute; pointer-events: none; font-weight: 700; text-shadow: 0 0 10px rgba(0,0,0,0.5);
  }
  @media (max-width: 720px) {
    #game-ui { grid-template-rows: auto 1fr auto; }
    .hud { grid-template-columns: repeat(2, minmax(0,1fr)); }
    .hud .tile:last-child { grid-column: span 2; }
    #game-ui { width: min(92vw, 440px); }
    .heart { width: 150px; height: 120px; }
    .heart-score .value { font-size: 42px; }
  }
</style>
</head>
<body>
<div id="app">
  <div id="start-screen" class="screen active">
    <div class="panel">
      <h1>Neon Block Puzzle</h1>
      <div class="subtitle">Classic 10x10 block puzzle with a neon twist</div>
      <div class="menu-buttons">
        <button class="btn primary" data-mode="endless">Endless Mode</button>
        <div class="row">
          <button class="btn alt" data-mode="clock" data-time="60">Clock Rush 1:00</button>
          <button class="btn alt" data-mode="clock" data-time="180">Clock Rush 3:00</button>
          <button class="btn alt" data-mode="clock" data-time="300">Clock Rush 5:00</button>
        </div>
        <div class="row">
          <button id="toggle-sound" class="btn ghost">Sound: On</button>
          <button id="toggle-music" class="btn ghost">Music: On</button>
        </div>
      </div>
    </div>
  </div>

  <div id="game-screen" class="screen">
    <div id="game-ui">
      <div class="hud">
        <div class="tile"><div class="label">Score</div><div id="score" class="value">0</div></div>
        <div class="tile"><div class="label">High Score</div><div id="high-score" class="value">0</div></div>
        <div class="tile"><div class="label">Timer</div><div id="timer" class="value">--:--</div></div>
      <div class="top-bar">
        <div class="score-chip"><span class="icon">ðŸ‘‘</span><span id="high-score">0</span></div>
        <button id="settings-btn" class="gear-btn" aria-label="Settings">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 8.7a3.3 3.3 0 1 0 0 6.6 3.3 3.3 0 0 0 0-6.6Zm9 3.3a7.6 7.6 0 0 0-.1-1l2-1.6-1.8-3.1-2.4.8a7.9 7.9 0 0 0-1.7-1l-.3-2.5H9.3l-.3 2.5a7.9 7.9 0 0 0-1.7 1l-2.4-.8-1.8 3.1 2 1.6a7.6 7.6 0 0 0 0 2l-2 1.6 1.8 3.1 2.4-.8a7.9 7.9 0 0 0 1.7 1l.3 2.5h5.4l.3-2.5a7.9 7.9 0 0 0 1.7-1l2.4.8 1.8-3.1-2-1.6c.1-.3.1-.7.1-1Z"/>
          </svg>
        </button>
      </div>
      <div class="heart-score">
        <div class="heart"><div id="score" class="value">0</div></div>
      </div>
      <div class="sub-hud">
        <span id="timer">--:--</span>
        <span id="combo-pill">Combo x1</span>
      </div>
      <div id="canvas-wrap">
        <canvas id="game-canvas" aria-label="Block puzzle board"></canvas>
        <div id="pause-overlay" class="overlay">
          <div class="panel" style="width: min(90vw, 420px);">
            <h1>Paused</h1>
            <div class="menu-buttons">
              <button id="resume-btn" class="btn primary">Resume</button>
              <button id="restart-btn" class="btn ghost">Restart</button>
              <button id="exit-btn" class="btn ghost">Exit to Menu</button>
            </div>
          </div>
        </div>
        <div id="gameover-overlay" class="overlay">
          <div class="panel" style="width: min(90vw, 420px);">
            <h1>Game Over</h1>
            <div class="subtitle" id="final-score">Score: 0</div>
            <div class="subtitle" id="final-high">High Score: 0</div>
            <div class="menu-buttons">
              <button id="play-again" class="btn primary">Play Again</button>
              <button id="back-menu" class="btn ghost">Back to Menu</button>
            </div>
          </div>
        </div>
      </div>
      <div id="tray"></div>
      <div class="footer-controls">
        <button id="pause-btn" class="btn ghost">Pause</button>
        <span id="combo-pill" class="pill">Combo x1</span>
        <button id="sound-btn" class="btn ghost">Sound: On</button>
      </div>
    </div>
  </div>
</div>
<script>
(() => {
  const GRID_SIZE = 10;
  const SHAPE_POOL = [
    [[0,0]],
    [[0,0],[1,0]],
    [[0,0],[0,1]],
    [[0,0],[1,0],[2,0]],
    [[0,0],[0,1],[0,2]],
    [[0,0],[1,0],[0,1]],
    [[0,0],[1,0],[2,0],[3,0]],
    [[0,0],[0,1],[0,2],[0,3]],
    [[0,0],[1,0],[0,1],[1,1]],
    [[0,0],[1,0],[2,0],[1,1]],
    [[0,0],[0,1],[0,2],[1,2]],
    [[0,0],[1,0],[2,0],[2,1]],
    [[0,0],[1,0],[1,1],[2,1]],
    [[0,0],[0,1],[1,1],[2,1]]
  ];
  const COLORS = ["#00f7ff", "#ff7ad9", "#ff9f43", "#6bff8e", "#b388ff", "#ff4f74", "#5effa0", "#7a9cff", "#ffed4a", "#4ae3ff"];
@@ -344,62 +401,78 @@
      cells: shape.map(([x,y]) => ({ x, y })),
      color: COLORS[Math.floor(Math.random() * COLORS.length)],
      used: false
    };
  }

  function fillTray() {
    state.tray = [randomShape(), randomShape(), randomShape()];
    renderTray();
  }

  function renderTray() {
    trayEl.innerHTML = "";
    state.tray.forEach((shape, idx) => {
      const item = document.createElement("div");
      item.className = "tray-item";
      item.dataset.index = idx;
      const mini = document.createElement("canvas");
      mini.width = 120; mini.height = 120;
      item.appendChild(mini);
      drawMini(mini.getContext("2d"), shape);
      trayEl.appendChild(item);
    });
  }

  function drawBlock(mctx, x, y, size, color, alpha = 1) {
    mctx.save();
    mctx.globalAlpha = alpha;
    const grad = mctx.createLinearGradient(x, y, x + size, y + size);
    grad.addColorStop(0, "#ffffff");
    grad.addColorStop(0.12, color);
    grad.addColorStop(0.75, color);
    grad.addColorStop(1, "#000000");
    mctx.fillStyle = grad;
    mctx.shadowColor = "rgba(0,0,0,0.25)";
    mctx.shadowBlur = 8;
    mctx.fillRect(x + 2, y + 2, size - 4, size - 4);
    mctx.shadowBlur = 0;
    mctx.strokeStyle = "rgba(255,255,255,0.28)";
    mctx.lineWidth = 2;
    mctx.strokeRect(x + 3, y + 3, size - 6, size - 6);
    mctx.restore();
  }

  function drawMini(mctx, shape) {
    if (!shape) return;
    const size = 20;
    const size = 22;
    const padding = 10;
    mctx.clearRect(0,0,120,120);
    mctx.save();
    mctx.translate(padding, padding);
    shape.cells.forEach(cell => {
      mctx.fillStyle = shape.color;
      mctx.shadowColor = shape.color;
      mctx.shadowBlur = 10;
      mctx.fillRect(cell.x * size, cell.y * size, size - 2, size - 2);
      drawBlock(mctx, cell.x * size, cell.y * size, size, shape.color, 0.95);
    });
    mctx.restore();
  }

  function resetGame(mode, time) {
    state.mode = mode;
    state.timeLeft = time || 0;
    state.timerActive = mode === "clock";
    state.score = 0;
    state.combo = 1;
    state.gameOver = false;
    state.paused = false;
    state.popups = [];
    state.clearAnimations = [];
    initGrid();
    fillTray();
    updateHUD();
    resizeCanvas();
    gameoverOverlay.classList.remove("active");
    pauseOverlay.classList.remove("active");
    ensureMusic();
  }

  function updateHUD() {
    scoreEl.textContent = state.score;
@@ -518,102 +591,96 @@
  }

  function updateHighScore() {
    const key = state.mode === "clock" ? "clock" : "endless";
    if (state.score > (state.highScores[key] || 0)) {
      state.highScores[key] = state.score;
      localStorage.setItem(`neon-block-${key}`, state.score.toString());
    }
  }

  function loadHighScores() {
    state.highScores.endless = parseInt(localStorage.getItem("neon-block-endless") || "0", 10);
    state.highScores.clock = parseInt(localStorage.getItem("neon-block-clock") || "0", 10);
  }

  function drawGrid() {
    const size = state.cell;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.scale(window.devicePixelRatio || 1, window.devicePixelRatio || 1);
    for (let y = 0; y < GRID_SIZE; y++) {
      for (let x = 0; x < GRID_SIZE; x++) {
        const cell = state.grid[y][x];
        const px = x * size;
        const py = y * size;
        ctx.strokeStyle = "rgba(255,255,255,0.08)";
        ctx.lineWidth = 1;
        const base = ctx.createLinearGradient(px, py, px + size, py + size);
        base.addColorStop(0, "rgba(38, 50, 92, 0.9)");
        base.addColorStop(1, "rgba(24, 34, 68, 0.9)");
        ctx.fillStyle = base;
        ctx.fillRect(px + 1, py + 1, size - 2, size - 2);
        ctx.strokeStyle = "rgba(0,0,0,0.35)";
        ctx.lineWidth = 2;
        ctx.strokeRect(px + 1, py + 1, size - 2, size - 2);
        if (cell) {
          const fade = cell.clearing ? Math.max(0, 1 - (performance.now() - cell.clearing) / 260) : 1;
          ctx.fillStyle = cell.color;
          ctx.globalAlpha = fade;
          ctx.shadowColor = cell.color;
          ctx.shadowBlur = 16;
          ctx.fillRect(px + 4, py + 4, size - 8, size - 8);
          ctx.globalAlpha = 1;
          ctx.shadowBlur = 0;
          drawBlock(ctx, px + 1, py + 1, size - 2, cell.color, fade);
        }
      }
    }
    if (state.dragging && state.dragging.valid && !state.paused) {
      ctx.save();
      ctx.globalAlpha = 0.4;
      ctx.globalAlpha = 0.45;
      state.dragging.shape.cells.forEach(cell => {
        const gx = state.dragging.gridX + cell.x;
        const gy = state.dragging.gridY + cell.y;
        if (gx < 0 || gy < 0 || gx >= GRID_SIZE || gy >= GRID_SIZE) return;
        ctx.fillStyle = state.dragging.shape.color;
        ctx.fillRect(gx * size + 4, gy * size + 4, size - 8, size - 8);
        drawBlock(ctx, gx * size + 1, gy * size + 1, size - 2, state.dragging.shape.color, 0.6);
      });
      ctx.restore();
    }
    state.popups.forEach(popup => {
      const age = performance.now() - popup.start;
      const t = age / 900;
      const rise = 20 * t;
      ctx.globalAlpha = 1 - t;
      ctx.fillStyle = popup.color;
      ctx.font = "bold 20px Segoe UI";
      ctx.fillText(popup.text, popup.x, popup.y - rise);
      ctx.globalAlpha = 1;
    });
    ctx.restore();
  }

  function drawDragging() {
    if (!state.dragging) return;
    const { shape } = state.dragging;
    const size = state.cell;
    shape.cells.forEach(cell => {
      const x = state.pointer.x + (cell.x * size) - state.offset.x;
      const y = state.pointer.y + (cell.y * size) - state.offset.y;
      ctx.fillStyle = shape.color;
      ctx.shadowColor = shape.color;
      ctx.shadowBlur = 16;
      ctx.fillRect(x + 4, y + 4, size - 8, size - 8);
      ctx.shadowBlur = 0;
      drawBlock(ctx, x + 2, y + 2, size - 4, shape.color, 0.95);
    });
  }

  function updateTimer(delta) {
    if (!state.timerActive || state.paused || state.gameOver) return;
    state.timeLeft = Math.max(0, state.timeLeft - delta / 1000);
    if (state.timeLeft === 0) {
      triggerGameOver();
    }
  }

  function triggerGameOver() {
    state.gameOver = true;
    pauseOverlay.classList.remove("active");
    gameoverOverlay.classList.add("active");
    finalScoreEl.textContent = `Score: ${state.score}`;
    const key = state.mode === "clock" ? "clock" : "endless";
    finalHighEl.textContent = `High Score: ${state.highScores[key] || 0}`;
    playSound("over");
    vibrate([60, 40, 80]);
  }

  function handlePointerDown(event) {
    if (state.paused || state.gameOver) return;
    const target = event.target.closest(".tray-item");
@@ -664,50 +731,54 @@
    state.lastTime = ts;
    if (!state.paused && !state.gameOver) {
      updateTimer(delta);
      updateClears();
      updatePopups();
    }
    updateHUD();
    drawGrid();
    if (state.dragging && !state.paused) drawDragging();
    requestAnimationFrame(gameLoop);
  }

  function bindEvents() {
    document.querySelectorAll("[data-mode]").forEach(btn => {
      btn.addEventListener("click", () => {
        const mode = btn.dataset.mode;
        const time = parseInt(btn.dataset.time || "0", 10);
        resetGame(mode, time);
        setScreen(gameScreen);
      });
    });
    document.getElementById("pause-btn").addEventListener("click", () => {
      state.paused = true;
      pauseOverlay.classList.add("active");
    });
    document.getElementById("settings-btn").addEventListener("click", () => {
      state.paused = true;
      pauseOverlay.classList.add("active");
    });
    document.getElementById("resume-btn").addEventListener("click", () => {
      state.paused = false;
      pauseOverlay.classList.remove("active");
    });
    document.getElementById("restart-btn").addEventListener("click", () => {
      resetGame(state.mode, state.timerActive ? Math.round(state.timeLeft) : 0);
    });
    document.getElementById("exit-btn").addEventListener("click", () => {
      setScreen(startScreen);
    });
    document.getElementById("play-again").addEventListener("click", () => {
      resetGame(state.mode, state.timerActive ? Math.round(state.timeLeft) : 0);
    });
    document.getElementById("back-menu").addEventListener("click", () => {
      setScreen(startScreen);
    });

    soundBtn.addEventListener("click", () => {
      state.soundOn = !state.soundOn;
      updateSoundButtons();
    });
    toggleSoundBtn.addEventListener("click", () => {
      state.soundOn = !state.soundOn;
      updateSoundButtons();
    });
